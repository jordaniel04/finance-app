<div class="transactions-container">
    <header class="transactions-header">
        <button mat-icon-button (click)="close()">
            <mat-icon>arrow_back</mat-icon>
        </button>
        <h2>Transacciones</h2>
        <mat-form-field appearance="fill" class="month-picker">
            <mat-label>Mes</mat-label>
            <input matInput [matDatepicker]="picker" [formControl]="selectedDate">
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker
                startView="year"
                (monthSelected)="monthSelected($event)"
                panelClass="month-picker-panel">
            </mat-datepicker>
        </mat-form-field>
    </header>

    <div class="transactions-list">
        <mat-accordion>
            <mat-expansion-panel *ngFor="let group of transactionGroups" [expanded]="group.expanded"
                (opened)="group.expanded = true" (closed)="group.expanded = false">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        <div class="date-group-header">
                            <span class="date-label">{{group.date | date:'EEEE, d MMMM yyyy':'':'es'}}</span>
                            <div class="amounts-summary">
                                <span class="income" *ngIf="group.totalIncome > 0">+{{group.totalIncome |
                                    customCurrency}}</span>
                                <span class="expense" *ngIf="group.totalExpense > 0">-{{group.totalExpense |
                                    customCurrency}}</span>
                            </div>
                        </div>
                    </mat-panel-title>
                </mat-expansion-panel-header>

                <app-transaction-item *ngFor="let transaction of group.transactions" [transaction]="transaction"
                    (edit)="onEditTransaction($event)" (delete)="onDeleteTransaction($event)">
                </app-transaction-item>
            </mat-expansion-panel>
        </mat-accordion>
    </div>

    <div class="monthly-summary">
        <div class="summary-content">
            <div class="summary-item">
                <span class="label">Saldo Anterior</span>
                <span class="amount" [class.income]="monthlyTotals.previousBalance >= 0"
                    [class.expense]="monthlyTotals.previousBalance < 0">
                    {{monthlyTotals.previousBalance | customCurrency}}
                </span>
            </div>
            <div class="summary-item">
                <span class="label">Ingresos</span>
                <span class="amount income">+{{monthlyTotals.income | customCurrency}}</span>
            </div>
            <div class="summary-item">
                <span class="label">Egresos</span>
                <span class="amount expense">-{{monthlyTotals.expense | customCurrency}}</span>
            </div>
            <div class="summary-item balance">
                <span class="label">Saldo Total</span>
                <span class="amount" [class.income]="monthlyTotals.totalBalance >= 0"
                    [class.expense]="monthlyTotals.totalBalance < 0">
                    {{monthlyTotals.totalBalance | customCurrency}}
                </span>
            </div>
        </div>
    </div>

    <button mat-fab class="add-transaction-fab" color="primary" (click)="openAddTransactionDialog()">
        <mat-icon>add</mat-icon>
    </button>
</div>